<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Upgrading to 1.2, Part 1: Deprecations - set_trace_func</title>

<!-- Meta -->
<meta name="description" content="Just a random coder writing about technology, web development, and various other geeky topics." />
<meta name="author" content="Jamie Macey">
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/index.xml" />

<!-- Favicons -->
<!-- 
<link rel="apple-touch-icon" href="/docs/5.2/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/docs/5.2/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/docs/5.2/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon.ico">
-->

<!-- Style -->
<link rel="stylesheet" href="/_bridgetown/static/index.J6BIDSPS.css" />

<!-- Script -->
<!-- <script src="/_bridgetown/static/index.PJZZ2K4I.js" defer></script> -->


    <link type="application/atom+xml" rel="alternate" href="https://blog.tracefunc.com/index.xml" title="set_trace_func" />
  </head>
  <body class="post ">
    <header>
  <nav>
    <ul>
      <li><h1><a href="/">set_trace_func</a></h1></li>
      <!-- The following float right, and are defined right-to-left -->
      <li class="float-right"><a href="/notes/">Notes</a></li>
      <li class="float-right"><a href="/projects/">Projects</a></li>
      <li class="float-right"><a href="/tags/">Tags</a></li>
      <li class="float-right"><a href="/archive/">Archive</a></li>
    </ul>
  </nav>
</header>


    <main>
      <aside>


<div>
  <h4>About</h4>
  <picture class="float-end w-50 rounded-circle">
    <source srcset="/assets/memoji.webp" type="image/webp">
    <source srcset="/assets/memoji.jpeg" type="image/jpeg">
    <img src="/assets/memoji.png" alt="Avatar of Author" loading="lazy" class="w-100">
  </picture>

  <p>Jamie Macey is a senior software engineer with over 15 years experience
            in the Ruby and Rails ecosystems, largely on the back-end.</p>
  <p class="mb-0">Husband, father, gamer, and all-around geek. Ask about my latest
            3d print, or toy software project.</p>
</div>

<div>
  <h4>Elsewhere</h4>
  <ol class="list-unstyled">
    <li>
      <a href="https://github.com/jamie/"">GitHub</a>
    </li>
    <li style="display: none;">
      <a rel="me" href="https://ruby.social/@jamie_ca">Mastodon</a>
    </li>
    <li>
      <a href="/static/jamie-macey/">Resume</a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/jamiemacey/">Linkedin</a>
    </li>
    <li>
      <a href="mailto:jamie.blog@tracefunc.com">Contact</a>
    </li>
  </ol>
</div>
</aside>

      <section>
  <article>
  <h2><a href="/2007/01/09/upgrading-to-1-2-part-1-deprecations-html/">Upgrading to 1.2, Part 1: Deprecations</a></h2>
  <blockquote>
    9th Jan 2007
    
      | Tags:
      <a href="/tags/#programming">programming</a> <a href="/tags/#rails">rails</a> 
    
  </blockquote>

  
    <p>So I’ve been spending some time lately working on upgrading the existing codebase for some projects at work such that they’ll work in Rails 1.2 once it’s released. Sadly, the upgrade process is not without its rough edges, and after two days of poking at it (it being a 5800 LOC app with 8800 LOC of tests) I’m still not completely done - the test run does not pass cleanly.</p>

<p>However, I have managed to get rid of most of the niggly deprecation warnings, so the output of the rake run is down to 450k from a high of about 2.2mb. Fun times. The changes required to silence most of the warnings are…</p>

<h2 id="activerecord">ActiveRecord</h2>

<p>find_all and find_first are deprecated. Use find(:all) and find(:first) instead.</p>

<p>If you have a has_many which is :dependent, make sure you’re specifying :destroy or :delete_all, rather than true. If you’ve got true you probably want to replace it with :destroy. Slower, but safer.</p>

<h2 id="routes">Routes</h2>

<p>Just a short note here, :requirements regexps no longer accept anchors. We have something along these lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>map.connect ':controller/:action/:foo', :requirements =&gt; { :foo =&gt; /^(bar|baz)$/ }
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Such that that route only fires if the third url part is exactly bar or baz. To silence 1.2, just remove the ^ and $ anchors.</p>

<h2 id="controllersviews">Controllers/Views</h2>

<p>The instance variables @params, @session, @request, and @flash are deprecated in controllers and views, use the version without the @. Note, don’t try and change this globally in your tests, or all hell will break loose. Oddly, assigns(:flash) in a test seems to trigger the warning for accessing @flash.</p>

<p>If you want to have your link_to go by post instead of get, use :method =&gt; :post instead of :post =&gt; true.</p>

<p>(Update: This will not throw errors, but won’t work in 1.1.6, so wait until you’re actually running 1.2 to do this change.)</p>

<p>Rendering with a string (render ‘template’) is no longer allowed. The deprecation warning says to render :file =&gt; ‘template’ instead, but if you want your code to continue to work in Rails 1.1.6 you’ll need to add a :use_full_path =&gt; true to the call.</p>

<p>start_form_tag and end_form_tag are now deprecated. The suggested replacement is to pass a block to a form_tag call, but that does not work at all in Rails 1.1.6. My preferred fix is to use a bare form_tag to start the form, and a hard-coded to finish it. Same goes with remote_form_tag for those AJAXy forms. That shuts up all the deprecation warnings, and allows for a fairly simple multiline regexp to blockify them up in the future. I was looking at something like &lt;%= ?(remote_)?form_tag([^%]<em>) ?%&gt;(.</em>?) and replacing with _&lt;% $1form_tag$2 do %&gt;$3&lt;% end %&gt;</p>

<p>We’ve got a few places where we’re redirecting to a named route: redirect_to :login_url. This calls url_for, which is deprecated. I think the correct solution is to just drop the colon and redirect_to login_url, but this doesn’t work in 1.1.6 and I haven’t quite tested it yet.</p>

<h2 id="tests">Tests</h2>

<p>Lastly, a change which I completely disagree with, assert_template_has and friends are now deprecated. Use assert(@response.has_session_object?(key)) instead, my ass. This changes removes a useful failure message like &lt;:login&gt; is not a template object and brings me back to the glory days of is not true. I know I’ll be rewriting those as custom assertions for my test_helper, thank you very much.</p>

<h2 id="to-be-continued">To Be Continued</h2>

<p>Like I said, I’m only half done this migration, but when I get the rest of it sorted, I’ll be posting a follow-up right here. See you then.</p>

  
</article>

</section>

<nav aria-label="Pagination">
  <ul>
    
    <li>
      <a href="/2007/01/03/how-to-crash-ruby-html/">
        &laquo; How to crash Ruby
      </a>
    </li>
    
    
    <li class="float-right">
      <a href="/2007/01/15/reinstall-html/">
        Reinstall &raquo;
      </a>
    </li>
    
  </ul>
</nav>

    </main>

    <footer>
  <p>Styled with <a href="https://classless.de/">Classless.css</a>.</p>
</footer>


    <script data-goatcounter="https://tracefunc.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </body>

</html>

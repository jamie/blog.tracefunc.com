<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Jekyll: Custom Liquid Tags - set_trace_func</title>

<!-- Meta -->
<meta name="description" content="Just a random coder writing about technology, web development, and various other geeky topics." />
<meta name="author" content="Jamie Macey">
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/index.xml" />

<!-- Favicons -->
<!-- 
<link rel="apple-touch-icon" href="/docs/5.2/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/docs/5.2/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/docs/5.2/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon.ico">
-->

<!-- Style -->
<link rel="stylesheet" href="/_bridgetown/static/index.J6BIDSPS.css" />

<!-- Script -->
<!-- <script src="/_bridgetown/static/index.PJZZ2K4I.js" defer></script> -->


    <link type="application/atom+xml" rel="alternate" href="https://blog.tracefunc.com/index.xml" title="set_trace_func" />
  </head>
  <body class="post ">
    <header>
  <nav>
    <ul>
      <li><h1><a href="/">set_trace_func</a></h1></li>
      <!-- The following float right, and are defined right-to-left -->
      <li class="float-right"><a href="/notes/">Notes</a></li>
      <li class="float-right"><a href="/projects/">Projects</a></li>
      <li class="float-right"><a href="/tags/">Tags</a></li>
      <li class="float-right"><a href="/archive/">Archive</a></li>
    </ul>
  </nav>
</header>


    <main>
      <aside>


<div>
  <h4>About</h4>
  <picture class="float-end w-50 rounded-circle">
    <source srcset="/assets/memoji.webp" type="image/webp">
    <source srcset="/assets/memoji.jpeg" type="image/jpeg">
    <img src="/assets/memoji.png" alt="Avatar of Author" loading="lazy" class="w-100">
  </picture>

  <p>Jamie Macey is a senior software engineer with over 15 years experience
            in the Ruby and Rails ecosystems, largely on the back-end.</p>
  <p class="mb-0">Husband, father, gamer, and all-around geek. Ask about my latest
            3d print, or toy software project.</p>
</div>

<div>
  <h4>Elsewhere</h4>
  <ol class="list-unstyled">
    <li>
      <a href="https://github.com/jamie/"">GitHub</a>
    </li>
    <li style="display: none;">
      <a rel="me" href="https://ruby.social/@jamie_ca">Mastodon</a>
    </li>
    <li>
      <a href="/static/jamie-macey/">Resume</a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/jamiemacey/">Linkedin</a>
    </li>
    <li>
      <a href="mailto:jamie.blog@tracefunc.com">Contact</a>
    </li>
  </ol>
</div>
</aside>

      <section>
  <article>
  <h2><a href="/2009/12/04/jekyll-custom-liquid-tags-html/">Jekyll: Custom Liquid Tags</a></h2>
  <blockquote>
    4th Dec 2009
    
      | Tags:
      <a href="/tags/#blog">blog</a> 
    
  </blockquote>

  
    <p>The base install of <a href="http://github.com/mojombo/jekyll">Jekyll</a> at the moment doesn’t let you run <em>any</em> arbitrary ruby code. This is so that they can use it for github pages and not need to worry about making a super-secure sandbox just to generate some HTML.</p>

<p>Unfortunately, that means we’re out of luck for creating custom liquid filters. The most annoying deficiency for me is tags. The way the default liquid <code class="highlighter-rouge">map</code> filter works isn’t friendly with @site.tags, so to generate my <a href="/tags/">Tags</a> page I had to do some really crazy stuff with <code class="highlighter-rouge">capture</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"articles"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    {% for tag_ in @site.tags %}
      {% capture tag %}{{ tag_ | first }}{% endcapture %}
      <span class="nt">&lt;tr&gt;&lt;th&gt;</span>{{ tag }}<span class="nt">&lt;/th&gt;</span>
          <span class="nt">&lt;th&gt;&lt;a</span> <span class="na">name=</span><span class="s">"{{ tag }}"</span> <span class="na">class=</span><span class="s">"anchor"</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
      {% for post in @site.posts %}
        {% if post.tags contains tag %}
          <span class="nt">&lt;tr&gt;&lt;td&gt;</span>{{ post.date | date: '%b %e, %Y' }}<span class="nt">&lt;/td&gt;</span>
              <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ post.url }}"</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span>
        {% endif %}
      {% endfor %}
    {% endfor %}
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fortunately, it wasn’t to hard to make a fork, and in <a href="http://github.com/jamie/jekyll">my fork</a> I added a super simple code loading option. Now, I can add a quick extension in <code class="highlighter-rouge">_lib/filters.rb</code> like so:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">module</span> <span class="nn">Jekyll</span>
  <span class="k">module</span> <span class="nn">Filters</span>
    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
      <span class="n">input</span><span class="p">.</span><span class="nf">keys</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">tagged</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
      <span class="n">input</span><span class="p">.</span><span class="nf">select</span><span class="p">{</span><span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">tags</span><span class="p">.</span><span class="nf">include?</span> <span class="n">tag</span><span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now <code class="highlighter-rouge">tags.html</code> looks like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"articles"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;table&gt;</span>
    {% for tag in @site.tags|keys|sort %}
      <span class="nt">&lt;tr&gt;&lt;th&gt;</span>{{ tag }}<span class="nt">&lt;/th&gt;</span>
          <span class="nt">&lt;th&gt;&lt;a</span> <span class="na">name=</span><span class="s">"{{ tag }}"</span> <span class="na">class=</span><span class="s">"anchor"</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
      {% for post in @site.posts|tagged:tag %}
        <span class="nt">&lt;tr&gt;&lt;td&gt;</span>{{ post.date | date: '%b %e, %Y' }}<span class="nt">&lt;/td&gt;</span>
            <span class="nt">&lt;td&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{{ post.url }}"</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;</span>
      {% endfor %}
    {% endfor %}
  <span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>There’s a bit of trickery there that liquid doesn’t document very well on lines 3 and 5 - in the second half of the for block you can chain filters on the collection you’re iterating over. The short format used is something along the lines of <code class="highlighter-rouge">collection|filter:arg,arg,arg|filter...</code></p>

<p>Similarly, I had some ugly code in my regular <a href="/archive/">archive</a> page to group by year and put headings in:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>{% for post in site.posts %}
  {% unless post.next %}
    <span class="nt">&lt;tr&gt;&lt;th&gt;</span>{{ post.date | date: '%Y' }}<span class="nt">&lt;/th&gt;&lt;th&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
  {% else %}
    {% capture year %}{{ post.date | date: '%Y' }}{% endcapture %}
    {% capture nyear %}{{ post.next.date | date: '%Y' }}{% endcapture %}
    {% if year != nyear %}
      <span class="nt">&lt;tr&gt;&lt;th&gt;</span>{{ post.date | date: '%Y' }}<span class="nt">&lt;/th&gt;&lt;th&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
    {% endif %}
  {% endunless %}

  ...
{% endfor %}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now, a few extra liquid filters later, it looks like this:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>{% for post in site.posts %}
  {% if post|last_of_year? %}
    <span class="nt">&lt;tr&gt;&lt;th&gt;</span>{{ post.date | date: '%Y' }}<span class="nt">&lt;/th&gt;&lt;th&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
  {% endif %}
  
  ...
{% endfor %}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you want to get easy extensions in your own project, rather than maintaining Yet Another Jekyll Fork, please vote up <a href="http://github.com/mojombo/jekyll/issues#issue/100">my merge request</a> on github.</p>

<hr />

<p>As a side note, blogging about liquid is a pain. The least pain I’ve found so far is to use liquid to output the leading open brace for all tags. Looks like garbage in my text editor, but it gets the job done:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{'{'}}{ post.title }}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Blogging about blogging about liquid (as above) I leave as an exercise to the reader.</p>

  
</article>

</section>

<nav aria-label="Pagination">
  <ul>
    
    <li>
      <a href="/2009/12/01/hoptoad-v2-in-merb-html/">
        &laquo; Hoptoad v2 in Merb
      </a>
    </li>
    
    
    <li class="float-right">
      <a href="/2009/12/22/migrating-disqus-html/">
        Migrating Disqus &raquo;
      </a>
    </li>
    
  </ul>
</nav>

    </main>

    <footer>
  <p>Styled with <a href="https://classless.de/">Classless.css</a>.</p>
</footer>


    <script data-goatcounter="https://tracefunc.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </body>

</html>

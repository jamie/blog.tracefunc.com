<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>set_trace_func</title>
    <meta content='text/html; charset=utf-8' http-equiv='content-type' />
    <link rel="stylesheet" href="/css/blueprint.css" type="text/css"/>
    <!--[if IE]>
      <link rel="stylesheet" href="/css/blueprint-ie.css" type="text/css"/>
    <![endif]-->
    <link rel="stylesheet" href="/css/master.css" type="text/css"/>
    <link href='http://feeds.feedburner.com/set_trace_func' rel='alternate' type='application/atom+xml' />

    <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
    <script type='text/javascript' src="/js/prettify.js"></script>
    <script type='text/javascript' src="/js/blog.js"></script>
  </head>
  <body>
    <div class='container'>
      <div class='span-20 last' id='header'>

        <h1>
          <a href='/'>set_trace_func</a>
        </h1>
        <h2>veni, vidi, didici</h2>
      </div>
      <div class='span-20 last' id='menu'>
        <div id='feedburner'>
          <a href='http://feeds.feedburner.com/set_trace_func'><img alt='RSS Feed' src='http://feeds.feedburner.com/~fc/set_trace_func?bg=0099ff&amp;fg=000000&amp;anim=0' /></a>
        </div>
        <ul style='float: right;'>
          <li><a>&#8203;</a></li>
          <li><a href='/about/'>About Me</a></li>
        </ul>
        <ul>
          <li><a href='/archive/'>Archive</a></li>
          <li><a href='/tags/'>Tags</a></li>
          <li><a href='/projects/'>Projects</a></li>
        </ul>
      </div>
      <div id='content-wrap'>
        <div class='span-18' id='content'>
          <div id="articles">
  
    <div class="article hentry">
      <h3 class="entry-title"><a href="/2009/12/01/hoptoad-v2-in-merb/">Hoptoad v2 in Merb</a></h3>
      <div class="meta">
        December 01, 2009
        
          |
          Tags:
          
            <a href="/tags.html#hoptoad">hoptoad</a>
          
            <a href="/tags.html#merb">merb</a>
          
        
      </div>
      <div class="entry-content"><p><a href="http://hoptoadapp.com">Hoptoad</a> has been bugging us for a week or two now to upgrade to v2 of its API, so we did that this week for our project at work. Except we're running Merb, not Rails.</p>

<p>Previously, we've been using Atmos' <a href="http://github.com/atmos/merb_hoptoad_notifier">merb_hoptoad plugin</a>, but it looks like it's been abandoned now in favor of a rack handler, and we needed to hack it a bit to support running multiple sites (with different API keys) off our single codebase. I'm always happy throwing code away, though, so I thought I'd try using the official <a href="http://github.com/thoughtbot/hoptoad_notifier">Hoptoad Notifier plugin</a> and see how hard it is to get working. It wasn't.</p>

<p>First, you probably want to make a gem of the plugin. <a href="http://github.com/thoughtbot/hoptoad_notifier">I forked it</a> a few days back, and just added a jeweller task to create the gem locally. Install in the local gems directory (or system-wide in production if you want to do it the hard way) and add it as a dependency.</p>

<p>Then, to actually use it, just add the following in the right places:</p>

<pre><code># init.rb, in Merb::Bootloader.after_app_loads

HoptoadNotifier.configure do |config|
  config.api_key = '...'
  config.environment_name = Merb.env
  config.project_root = Merb.root
  # See http://github.com/thoughtbot/hoptoad_notifier/ README.rdoc
  # for other config settings. You probably want to think about
  # params_filters and maybe ignore.
end

# application.rb, if you want available manually.
# If you just want it for completely unexpected errors you can stick it in
# exceptions.rb instead

def notify_hoptoad(error=nil)
  error ||= request.exceptions.first

  data = {
    :controller       =&gt; params[:controller],
    :action           =&gt; params[:action],
    :url              =&gt; "#{request.protocol}://#{request.host}#{request.uri}",
    # Looks like hoptoad is filtering these itself, we don't need to worry about it
    # other than configuring what needs to be filtered
    :parameters       =&gt; params.to_hash,
    :session_data     =&gt; session.to_hash,
    :cgi_data         =&gt; request.env.to_hash,
    :environment_vars =&gt; ENV.to_hash.merge(:RAILS_ENV =&gt; Merb.env)
  }

  HoptoadNotifier.notify(error, data)
end

# exceptions.rb, override default error handlers to submit to hoptoad

def internal_server_error
  notify_hoptoad
  render
end

def standard_error
  notify_hoptoad
  render
end    

# other spots you handle exceptions inline, just pass in the exception

begin
 ...
rescue =&gt; e
  notify_hoptoad(e)
end
</code></pre>

<p>It's not exactly as magical as the Rails plugin's auto-including, but it looks like it's getting the job done for us.</p>
</div>
    </div>
  
    <div class="article hentry">
      <h3 class="entry-title"><a href="/2009/11/30/enter-jekyll/">Enter Jekyll</a></h3>
      <div class="meta">
        November 30, 2009
        
          |
          Tags:
          
            <a href="/tags.html#blog">blog</a>
          
        
      </div>
      <div class="entry-content"><p>So I've gone and switched up blogging platforms again. This time, it's <a href="http://github.com/mojombo/jekyll">Jekyll</a>. It's not that I had any problems with <a href="http://github.com/TwP/webby/">webby</a>, just thought I'd try it out. After spending a few hours porting things over (mostly layout and helpers, my posts are already in <a href="http://daringfireball.net/projects/markdown/">markdown</a>) I think I'm going to stick with it.</p>

<p>Being blog-aware is looking like a huge win - if I'm ok with my posts just being recorded by date, rather than date+time, there's a lot less overhead that needs to get done to push a new post up. I have smaller YAML preambles, and the only custom code I'm maintaining is some custom Liquid filters. With less time being spent worrying about the blog software, I might be more successful at the whole blog-writing bit. Maybe.</p>
</div>
    </div>
  
    <div class="article hentry">
      <h3 class="entry-title"><a href="/2009/11/09/heroku/">Heroku</a></h3>
      <div class="meta">
        November 09, 2009
        
          |
          Tags:
          
            <a href="/tags.html#programming">programming</a>
          
        
      </div>
      <div class="entry-content"><p><a href="http://heroku.com">Heroku</a> kicks ass. Very nifty tech running the show, and a really simple interface for deploying - just push up your git repository.</p>

<p>I run this blog through <a href="http://webby.rubyforge.org">webby</a>, which translates some boring old markdown into html so that I can serve it as static files. I like that amount of snappiness.  Heroku wants to run something ruby - rails, merb, or barebones rack.</p>

<p>Turns out, setting up rack to pass static files through is pretty easy, and since I think it just uses send_file behind the scenes, it should be all set up for Heroku to cache it in their Varnish layer, if I ever happen to get a traffic spike.</p>

<p>All you need is a config.ru file like so, and then be sure to include the generated output dir in your git repository:</p>

<pre><code># I don't have file extensions on entry permalinks
Rack::Mime::MIME_TYPES.merge!("" =&gt; "text/html")

class DefaultIndexFile
  def initialize(app, &amp;block)
    @app = app
    yield self if block_given?
  end

  def call(env)
    env['PATH_INFO'] &lt;&lt; 'index.html' if env['PATH_INFO'] =~ /\/$/
    @app.call(env)
  end
end

use DefaultIndexFile

run Rack::File.new('output')
</code></pre>
</div>
    </div>
  
    <div class="article hentry">
      <h3 class="entry-title"><a href="/2009/06/21/installing-wifi-without-internet/">Installing Wifi without Internet</a></h3>
      <div class="meta">
        June 21, 2009
        
          |
          Tags:
          
            <a href="/tags.html#linux">linux</a>
          
        
      </div>
      <div class="entry-content"><p>I picked up a <a href="http://www.ncix.com/products/?sku=33671">new machine</a> this week to turn into a home media server, and had a small hoop to jump through with the Broadcom <a href="http://www.ncix.com/products/?sku=24255">wifi card</a> I picked up. Problem being, office and all my monitors were upstairs, wifi was downstairs, and it's difficult to install new drivers without net access.</p>

<p>But, <a href="http://www.linuxmint.com">Linux Mint</a> popped up a "new hardware" dialog, saying it wanted to use b43-fwripper to set up the drivers. Good news, it gave me the url it failed to download from. Manually download <a href="http://archive.ubuntu.com/ubuntu/pool/main/b/b43-fwcutter/b43-fwcutter_011-5_i386.deb">the deb</a>, open it up on my other machine using Archive Manager (rather than GDebi), and navigate through to the postinstall script, at data.tar.gz/./usr/share/b43-fwcutter/, and I find a reference to two <a href="http://downloads.openwrt.org/sources/wl_apsta-3.130.20.0.o">other</a> <a href="http://mirror2.openwrt.org/sources/broadcom-wl-4.150.10.5.tar.bz2">files</a>.</p>

<p>After downloading those, copy all three files to the new box. Copy the .deb to /var/cache/apt/archives, and then apt-get install b43-fwripper. Ignore the failure, then go to the dir with the other two files, and manually run the 3 useful lines from the install script (don't forget to add sudo to the last one):</p>

<pre><code>b43-fwcutter -w /lib/firmware wl_apsta-3.130.20.0.o
tar xfvj broadcom-wl-4.150.10.5.tar.bz2
b43-fwcutter --unsupported -w /lib/firmware broadcom-wl-4.150.10.5/driver/wl_apsta_mimo.o
</code></pre>

<p>Reboot, and voila - local wifi networks show up in the tray applet. I presume these steps will work for an Ubuntu install as well, since Mint is based on Ubuntu, but I haven't tried it as yet - in fact, the required .deb is on the Ubuntu 9.04 livecd. I also don't know if these files will work for other Broadcom wireless adapters, but if your modern linux system can do a hardware detect and tell you what driver it's trying to pull down, that should be a good starting point.</p>
</div>
    </div>
  
    <div class="article hentry">
      <h3 class="entry-title"><a href="/2009/02/21/fib-for-fun/">Fib for Fun</a></h3>
      <div class="meta">
        February 21, 2009
        
          |
          Tags:
          
            <a href="/tags.html#programming">programming</a>
          
        
      </div>
      <div class="entry-content"><p>A little math can be a dangerous thing.  Here's a quick benchmark for Fibonacci numbers (Y axis in seconds, 20,000 iterations):</p>

<p><img src="http://img.skitch.com/20090222-p4e42eew9gbknfis86pdms813f.png" alt="Graph" /></p>

<p>The line on the left, marked A, is the typical naive recursive solution, based as directly as possible on the mathematical definition of the function:</p>

<pre><code>def fib_r(n)
  return 1 if n &lt;= 2
  fib_r(n-1) + fib_r(n-2)
end
</code></pre>

<p>Note the telltale exponential curve - this is what we call Very Bad.  The line there stops at Fib(10).</p>

<p>A little jiggery lets us convert the recursive solution into an iterative one, line B:</p>

<pre><code>def fib_i(n)
  x = y = 1
  (n-1).times do
    x, y = y, x+y
  end
  x
end
</code></pre>

<p>My personal favorite Fib function is (ab)using a hash's default value function to act as a memoizer.  Line C is the fastest of the bunch (constant time of ~0.012s) but does have some extra memory overhead.</p>

<pre><code>def fib_h(n)
  @h ||= Hash.new{ |h,k|
    if k &lt; 2
      h[k] = k
    else
      h[k] = h[k-1] + h[k-2]
    end
  }
  @h[n]
end
</code></pre>

<p>If we were in an embedded system or something, the memory overhead would probably be bad, but fear not!  Math can save us!</p>

<p>Line D is also constant time, but about 0.037s.  It's a fun little bit of math mentioned in <a href="http://mitpress.mit.edu/sicp/">SICP</a>, and turns Fibonacci numbers into a very simple (if unintuitive) bit of math:</p>

<pre><code>SQRT5 = Math.sqrt(5.0)
PHI = (1 + SQRT5) / 2
PSI = (1 - SQRT5) / 2

def fib_m(n)
  ((PHI ** n - PSI ** n) / SQRT5).to_i
end
</code></pre>
</div>
    </div>
  
</div>

        </div>
      </div>
      <div class='span-20 last' id='footer'>
        <p>
          &copy; 2006-2008 <span class="author vcard"><span class="fn">Jamie Macey</span></span>
          |
          Original design: <a href="http://www.styleshout.com/templates/preview/CoolWater1-0/index.html">CoolWater</a> by <a href="http://www.styleshout.com/">styleshout</a>
        </p>
      </div>
    </div>

    <script type='text/javascript'>
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type='text/javascript'>
      try {
        var pageTracker = _gat._getTracker("UA-11614297-1");
        pageTracker._setDomainName(".tracefunc.com");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>

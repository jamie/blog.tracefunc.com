<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Modular Rails Infrastructure - set_trace_func</title>

<!-- Meta -->
<meta name="description" content="Just a random coder writing about technology, web development, and various other geeky topics." />
<meta name="author" content="Jamie Macey">
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/index.xml" />

<!-- Favicons -->
<!-- 
<link rel="apple-touch-icon" href="/docs/5.2/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/docs/5.2/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/docs/5.2/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon.ico">
-->

<!-- Style -->
<link rel="stylesheet" href="/_bridgetown/static/index.J6BIDSPS.css" />

<!-- Script -->
<!-- <script src="/_bridgetown/static/index.PJZZ2K4I.js" defer></script> -->


    <link type="application/atom+xml" rel="alternate" href="https://blog.tracefunc.com/index.xml" title="set_trace_func" />
  </head>
  <body class="notable ">
    <header>
  <nav>
    <ul>
      <li><h1><a href="/">set_trace_func</a></h1></li>
      <!-- The following float right, and are defined right-to-left -->
      <li class="float-right"><a href="/notes/">Notes</a></li>
      <li class="float-right"><a href="/projects/">Projects</a></li>
      <li class="float-right"><a href="/tags/">Tags</a></li>
      <li class="float-right"><a href="/archive/">Archive</a></li>
    </ul>
  </nav>
</header>


    <main>
      <aside>


<div>
  <h4>About</h4>
  <picture class="float-end w-50 rounded-circle">
    <source srcset="/assets/memoji.webp" type="image/webp">
    <source srcset="/assets/memoji.jpeg" type="image/jpeg">
    <img src="/assets/memoji.png" alt="Avatar of Author" loading="lazy" class="w-100">
  </picture>

  <p>Jamie Macey is a senior software engineer with over 15 years experience
            in the Ruby and Rails ecosystems, largely on the back-end.</p>
  <p class="mb-0">Husband, father, gamer, and all-around geek. Ask about my latest
            3d print, or toy software project.</p>
</div>

<div>
  <h4>Elsewhere</h4>
  <ol class="list-unstyled">
    <li>
      <a href="https://github.com/jamie/"">GitHub</a>
    </li>
    <li style="display: none;">
      <a rel="me" href="https://ruby.social/@jamie_ca">Mastodon</a>
    </li>
    <li>
      <a href="/static/jamie-macey/">Resume</a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/jamiemacey/">Linkedin</a>
    </li>
    <li>
      <a href="mailto:jamie.blog@tracefunc.com">Contact</a>
    </li>
  </ol>
</div>
</aside>

      <section>
  <article>
  <h1 id="modular-rails-infrastructure">Modular Rails Infrastructure</h1>

<ul>
  <li>
    <p>Dan Manges writes up <a href="https://medium.com/@dan_manges/the-modular-monolith-rails-architecture-fb1023826fc4">an approach to using engines</a> where the primary Rails app is empty, and merely requires a number of gems + engines. Initial migration sounded like: main app -&gt; engine (so that other engines can depend on it), then admin, API, and frontend can all become separate engines depending on the main “models” engine. After that, models can potentially be split apart into domain contexts, and similarly service objects and miscellany can be focused by domain.
Benefits to this are a clear delineation of dependencies, and the ability to run tests for each engine independently (so if A and B depend on C but not each other, a change in B doesn’t require tests for A to be run).</p>
  </li>
  <li>
    <p>Consider? Bust hard mid-tier dependencies (between groups of models, for examples) by hooking up pub-sub at the controllers level (see <a href="https://github.com/krisleech/wisper">wisper</a> as an example)</p>
  </li>
  <li>
    <p>Double-check: auto code reloading from dependent gems (see https://format-express.dev/blog/embed-a-gem-in-a-rails-project-and-enable-autoreload#setup-autoreload)</p>
  </li>
</ul>

<h3 id="github-actions">Github Actions</h3>

<p>Github actions can set an output variable by printing to stdout: <code class="highlighter-rouge">::set-output name=variable::value</code></p>

<p>If I have a step named <code class="highlighter-rouge">filter-components</code> that does dependency analysis to determine which gems/engines to build, and I run a loop <code class="highlighter-rouge">puts "::set-output name=#{component}::#{component}}"</code> then I should be able to set up build steps for each component, like so:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>&lt;% components.each do |component| %&gt;
&lt;%= component %&gt;:
  needs: filter-components
  if: ${{ contains(steps.filter-components.outputs.*, '&lt;%= component %&gt;') }}
  steps...
</pre></td></tr></tbody></table></code></pre></div></div>

<p>and I think this will properly flag skippable components as not-run (grey) without failing the build or acting as though they were run and are passing.</p>

<h4 id="setup-ruby">setup-ruby</h4>

<p>Note: the ruby/setup-ruby action <a href="https://github.com/ruby/setup-ruby#caching-bundle-install-automatically">now supports bundler caching natively</a></p>


</article>

</section>

    </main>

    <footer>
  <p>Styled with <a href="https://classless.de/">Classless.css</a>.</p>
</footer>


    <script data-goatcounter="https://tracefunc.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </body>

</html>

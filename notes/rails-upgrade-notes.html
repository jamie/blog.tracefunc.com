<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Rails Upgrade Notes - set_trace_func</title>

<!-- Meta -->
<meta name="description" content="Just a random coder writing about technology, web development, and various other geeky topics." />
<meta name="author" content="Jamie Macey">
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/index.xml" />

<!-- Favicons -->
<!-- 
<link rel="apple-touch-icon" href="/docs/5.2/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
<link rel="manifest" href="/docs/5.2/assets/img/favicons/manifest.json">
<link rel="mask-icon" href="/docs/5.2/assets/img/favicons/safari-pinned-tab.svg" color="#712cf9">
<link rel="icon" href="/docs/5.2/assets/img/favicons/favicon.ico">
-->

<!-- Style -->
<link rel="stylesheet" href="/_bridgetown/static/index.J6BIDSPS.css" />

<!-- Script -->
<!-- <script src="/_bridgetown/static/index.PJZZ2K4I.js" defer></script> -->


    <link type="application/atom+xml" rel="alternate" href="https://blog.tracefunc.com/index.xml" title="set_trace_func" />
  </head>
  <body class="notable ">
    <header>
  <nav>
    <ul>
      <li><h1><a href="/">set_trace_func</a></h1></li>
      <!-- The following float right, and are defined right-to-left -->
      <li class="float-right"><a href="/notes/">Notes</a></li>
      <li class="float-right"><a href="/projects/">Projects</a></li>
      <li class="float-right"><a href="/tags/">Tags</a></li>
      <li class="float-right"><a href="/archive/">Archive</a></li>
    </ul>
  </nav>
</header>


    <main>
      <aside>


<div>
  <h4>About</h4>
  <picture class="float-end w-50 rounded-circle">
    <source srcset="/assets/memoji.webp" type="image/webp">
    <source srcset="/assets/memoji.jpeg" type="image/jpeg">
    <img src="/assets/memoji.png" alt="Avatar of Author" loading="lazy" class="w-100">
  </picture>

  <p>Jamie Macey is a senior software engineer with over 15 years experience
            in the Ruby and Rails ecosystems, largely on the back-end.</p>
  <p class="mb-0">Husband, father, gamer, and all-around geek. Ask about my latest
            3d print, or toy software project.</p>
</div>

<div>
  <h4>Elsewhere</h4>
  <ol class="list-unstyled">
    <li>
      <a href="https://github.com/jamie/"">GitHub</a>
    </li>
    <li style="display: none;">
      <a rel="me" href="https://ruby.social/@jamie_ca">Mastodon</a>
    </li>
    <li>
      <a href="/static/jamie-macey/">Resume</a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/jamiemacey/">Linkedin</a>
    </li>
    <li>
      <a href="mailto:jamie.blog@tracefunc.com">Contact</a>
    </li>
  </ol>
</div>
</aside>

      <section>
  <article>
  <h1 id="rails-upgrade-notes">Rails Upgrade Notes</h1>

<p><a href="https://www.fastruby.io/blog/rails/upgrade/rails-upgrade-series.html">Version by version guide</a>, courtesy of FastRuby.io.</p>

<hr />

<p>Good advice from <a href="https://blog.arkency.com/painless-rails-upgrades/">Arkency</a>:</p>

<blockquote>
  <p>Go for tactical DDD patterns for your core domain. Modularize your code, extract <a href="https://blog.arkency.com/tags/bounded-context/">Bounded Contexts</a>. Use Rails where they shine: <code class="highlighter-rouge">ApplicationController</code>, <code class="highlighter-rouge">ActiveRecord</code> used for writes and reads without the callback hell and STI. We’ve shown you the alternative approach many times: <a href="https://blog.arkency.com/tags/commands/">commands</a>, <a href="https://blog.arkency.com/tags/service-objects/">service objects</a>, <a href="https://blog.arkency.com/tags/process-manager/">process managers</a>, etc. Believe us, your next upgrade will be just a matter of Rails version bump in your Gemfile.</p>
</blockquote>

<h3 id="via-rubocop">Via Rubocop</h3>

<p>It should be possible to leverage Rubocop to migrate a bunch of mechanical/api changes. For example, upgrading Rails 4 -&gt; 5 on a recent project, this would be a trivial change to automate a rewrite:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>-  before_filter :ensure_policy_access
+  before_action :ensure_policy_access
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Especially on larger teams with existing work going along parallel to upgrade work, it’s very worthwhile to write some rewrite cops to both ease merging new features into an upgrade branch, and to act as a reminder/safety net after the upgrade hits master to guide other developers.</p>

<p>In fact, the <a href="https://docs.rubocop.org/rubocop-rails/cops_rails.html">rubocop-rails</a> gem may actually cover</p>

<p>See <a href="https://kirshatrov.com/2016/12/18/rewrite-code-with-rubocop/">this article</a> for a starter example, and <a href="https://medium.com/@SamJewell/make-your-rails-5-upgrade-easier-with-rubocop-7f9a700b0112">this article</a> that stands up an example workflow with what I think are some cops already in core Rubocop.</p>

<h3 id="via-synvert">Via Synvert</h3>

<p><a href="https://synvert.xinminlabs.com/">Synvert</a> is a generic code-rewriter, which comes with a bunch of Ruby/Rails rules. Also seems reasonably easy to write your own, and has a GUI that will allow you to provide before/after examples and will generate the appropriate code for you.</p>


</article>

</section>

    </main>

    <footer>
  <p>Styled with <a href="https://classless.de/">Classless.css</a>.</p>
</footer>


    <script data-goatcounter="https://tracefunc.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </body>

</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>set_trace_func</title>
    <meta content='text/html; charset=utf-8' http-equiv='content-type' />
    <link rel="stylesheet" href="/css/blueprint.css" type="text/css"/>
    <!--[if IE]>
      <link rel="stylesheet" href="/css/blueprint-ie.css" type="text/css"/>
    <![endif]-->
    <link rel="stylesheet" href="/css/master.css" type="text/css"/>
    <link href='http://feeds.feedburner.com/set_trace_func' rel='alternate' type='application/atom+xml' />
    <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
    <script type='text/javascript' src="/js/prettify.js"></script>
    <script type='text/javascript' src="/js/blog.js"></script>
  </head>
  <body>
    <div class='container'>
      <div class='span-20 last' id='header'>
        <h1>
          <a href='/'>set_trace_func</a>
        </h1>
        <h2>veni, vidi, didici</h2>
      </div>
      <div class='span-20 last' id='menu'>
        <div id='feedburner'>
          <a href='http://feeds.feedburner.com/set_trace_func'>
            <img alt='RSS Feed' src='http://feeds.feedburner.com/~fc/set_trace_func?bg=0099ff&amp;fg=000000&amp;anim=0' />
          </a>
        </div>
        <ul style='float: right;'>
          <li>
            <a>&#8203;</a>
          </li>
          <li>
            <a href='/about.html'>About Me</a>
          </li>
        </ul>
        <ul>
          <li>
            <a href='/archive.html'>Archive</a>
          </li>
          <li>
            <a href='/tags.html'>Tags</a>
          </li>
          <li>
            <a href='/projects.html'>Projects</a>
          </li>
        </ul>
      </div>
      <div id='content-wrap'>
        <div class='span-18' id='content'>
          <div id='articles'>
            <div class='article hentry'>
              <!-- %h3.entry-title{:rel => 'bookmark'}= link_to_page(page) -->
              <h3 class='entry-title'><a href="/2006/05/01/heroku">Heroku</a></h3>
              <div class='entry-content'>
                <p><a href="http://heroku.com">Heroku</a> kicks ass. Very nifty tech running the show, and a really simple interface for deploying - just push up your git repository.</p>
                
                <p>I run this blog through <a href="http://webby.rubyforge.org">webby</a>, which translates some boring old markdown into html so that I can serve it as static files. I like that amount of snappiness.  Heroku wants to run something ruby - rails, merb, or barebones rack.</p>
                
                <p>Turns out, setting up rack to pass static files through is pretty easy, and since I think it just uses send_file behind the scenes, it should be all set up for Heroku to cache it in their Varnish layer, if I ever happen to get a traffic spike.</p>
                
                <p>All you need is a config.ru file like so, and then be sure to include the generated output dir in your git repository:</p>
                
                <pre><code># I don't have file extensions on entry permalinks&#x000A;Rack::Mime::MIME_TYPES.merge!("" =&gt; "text/html")&#x000A;&#x000A;class DefaultIndexFile&#x000A;  def initialize(app, &amp;block)&#x000A;    @app = app&#x000A;    yield self if block_given?&#x000A;  end&#x000A;&#x000A;  def call(env)&#x000A;    env['PATH_INFO'] &lt;&lt; 'index.html' if env['PATH_INFO'] =~ /\/$/&#x000A;    @app.call(env)&#x000A;  end&#x000A;end&#x000A;&#x000A;use DefaultIndexFile&#x000A;&#x000A;run Rack::File.new('output')&#x000A;</code></pre>
              </div>
              <div class='footer'>
                <abbr class="published date" title="2009-11-09T17:07:00-04:00">Nov  9, 2009 at 17:07</abbr>
                &nbsp; | &nbsp; tagged:
                <a href="/tags.html#programming">programming</a>
              </div>
            </div>
            <div class='article hentry'>
              <!-- %h3.entry-title{:rel => 'bookmark'}= link_to_page(page) -->
              <h3 class='entry-title'><a href="/2009/06/21/installing-wifi-without-internet">Installing Wifi without Internet</a></h3>
              <div class='entry-content'>
                <p>I picked up a <a href="http://www.ncix.com/products/?sku=33671">new machine</a> this week to turn into a home media server, and had a small hoop to jump through with the Broadcom <a href="http://www.ncix.com/products/?sku=24255">wifi card</a> I picked up. Problem being, office and all my monitors were upstairs, wifi was downstairs, and it's difficult to install new drivers without net access.</p>
                
                <p>But, <a href="http://www.linuxmint.com">Linux Mint</a> popped up a "new hardware" dialog, saying it wanted to use b43-fwripper to set up the drivers. Good news, it gave me the url it failed to download from. Manually download <a href="http://archive.ubuntu.com/ubuntu/pool/main/b/b43-fwcutter/b43-fwcutter_011-5_i386.deb">the deb</a>, open it up on my other machine using Archive Manager (rather than GDebi), and navigate through to the postinstall script, at data.tar.gz/./usr/share/b43-fwcutter/, and I find a reference to two <a href="http://downloads.openwrt.org/sources/wl_apsta-3.130.20.0.o">other</a> <a href="http://mirror2.openwrt.org/sources/broadcom-wl-4.150.10.5.tar.bz2">files</a>.</p>
                
                <p>After downloading those, copy all three files to the new box. Copy the .deb to /var/cache/apt/archives, and then apt-get install b43-fwripper. Ignore the failure, then go to the dir with the other two files, and manually run the 3 useful lines from the install script (don't forget to add sudo to the last one):</p>
                
                <pre><code>b43-fwcutter -w /lib/firmware wl_apsta-3.130.20.0.o&#x000A;tar xfvj broadcom-wl-4.150.10.5.tar.bz2&#x000A;b43-fwcutter --unsupported -w /lib/firmware broadcom-wl-4.150.10.5/driver/wl_apsta_mimo.o&#x000A;</code></pre>
                
                <p>Reboot, and voila - local wifi networks show up in the tray applet. I presume these steps will work for an Ubuntu install as well, since Mint is based on Ubuntu, but I haven't tried it as yet - in fact, the required .deb is on the Ubuntu 9.04 livecd. I also don't know if these files will work for other Broadcom wireless adapters, but if your modern linux system can do a hardware detect and tell you what driver it's trying to pull down, that should be a good starting point.</p>
              </div>
              <div class='footer'>
                <abbr class="published date" title="2009-06-21T19:37:00-04:00">Jun 21, 2009 at 19:37</abbr>
                &nbsp; | &nbsp; tagged:
                <a href="/tags.html#linux">linux</a>
              </div>
            </div>
            <div class='article hentry'>
              <!-- %h3.entry-title{:rel => 'bookmark'}= link_to_page(page) -->
              <h3 class='entry-title'><a href="/2009/02/21/fib-for-fun">Fib for Fun</a></h3>
              <div class='entry-content'>
                <p>A little math can be a dangerous thing.  Here's a quick benchmark for Fibonacci numbers (Y axis in seconds, 20,000 iterations):</p>
                
                <p><img src="http://img.skitch.com/20090222-p4e42eew9gbknfis86pdms813f.png" alt="Graph" /></p>
                
                <p>The line on the left, marked A, is the typical naive recursive solution, based as directly as possible on the mathematical definition of the function:</p>
                
                <pre><code>def fib_r(n)&#x000A;  return 1 if n &lt;= 2&#x000A;  fib_r(n-1) + fib_r(n-2)&#x000A;end&#x000A;</code></pre>
                
                <p>Note the telltale exponential curve - this is what we call Very Bad.  The line there stops at Fib(10).</p>
                
                <p>A little jiggery lets us convert the recursive solution into an iterative one, line B:</p>
                
                <pre><code>def fib_i(n)&#x000A;  x = y = 1&#x000A;  (n-1).times do&#x000A;    x, y = y, x+y&#x000A;  end&#x000A;  x&#x000A;end&#x000A;</code></pre>
                
                <p>My personal favorite Fib function is (ab)using a hash's default value function to act as a memoizer.  Line C is the fastest of the bunch (constant time of ~0.012s) but does have some extra memory overhead.</p>
                
                <pre><code>def fib_h(n)&#x000A;  @h ||= Hash.new{ |h,k|&#x000A;    if k &lt; 2&#x000A;      h[k] = k&#x000A;    else&#x000A;      h[k] = h[k-1] + h[k-2]&#x000A;    end&#x000A;  }&#x000A;  @h[n]&#x000A;end&#x000A;</code></pre>
                
                <p>If we were in an embedded system or something, the memory overhead would probably be bad, but fear not!  Math can save us!</p>
                
                <p>Line D is also constant time, but about 0.037s.  It's a fun little bit of math mentioned in <a href="http://mitpress.mit.edu/sicp/">SICP</a>, and turns Fibonacci numbers into a very simple (if unintuitive) bit of math:</p>
                
                <pre><code>SQRT5 = Math.sqrt(5.0)&#x000A;PHI = (1 + SQRT5) / 2&#x000A;PSI = (1 - SQRT5) / 2&#x000A;&#x000A;def fib_m(n)&#x000A;  ((PHI ** n - PSI ** n) / SQRT5).to_i&#x000A;end&#x000A;</code></pre>
              </div>
              <div class='footer'>
                <abbr class="published date" title="2009-02-21T22:31:41-05:00">Feb 21, 2009 at 22:31</abbr>
                &nbsp; | &nbsp; tagged:
                <a href="/tags.html#programming">programming</a>
              </div>
            </div>
            <div class='article hentry'>
              <!-- %h3.entry-title{:rel => 'bookmark'}= link_to_page(page) -->
              <h3 class='entry-title'><a href="/2009/02/20/geoip-city-on-leopard">geoip_city on Leopard</a></h3>
              <div class='entry-content'>
                <p>I've been trying to figure out a minimal way of getting the geoip_city gem installed on my mac, and having <a href="http://snippets.aktagon.com/snippets/179-Geolocation-with-MaxMind-s-GeoIP-and-the-geoip-city-RubyGem">seen</a> a few <a href="http://www.rubynarails.com/22/8/2008/how-to-install-geoip_city-gem-on-leopard">ideas</a> on google, I'm gonna consolidate into a minimal solution.  I originally wanted to work with the macports version of libgeoip, but had absolutely no luck with that, so here's something a bit more manual:</p>
                
                <pre><code># we need to be root for the ARCHFLAGS later to stick&#x000A;sudo su&#x000A;&#x000A;mkdir -p /usr/local/src&#x000A;cd /usr/local/src&#x000A;&#x000A;# Download and install latest geoip&#x000A;curl -O http://geolite.maxmind.com/download/geoip/api/c/GeoIP-1.4.5.tar.gz&#x000A;tar -xzf GeoIP-1.4.5.tar.gz&#x000A;cd GeoIP-1.4.5&#x000A;./configure&#x000A;make&#x000A;make check&#x000A;make install&#x000A;&#x000A;# install the gem&#x000A;export ARCHFLAGS='-arch i386'&#x000A;gem install geoip_city&#x000A;</code></pre>
                
                <p>The main sticking point for me was that setting ARCHFLAGS doesn't continue through to a <code>sudo gem install</code>, so we need to do the whole thing as root.</p>
                
                <p>But, now that we've done that, we can grab the GeoLiteCity database and point our app at it:</p>
                
                <pre><code>curl -O http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz&#x000A;gunzip GeoLiteCity.dat.gz&#x000A;</code></pre>
              </div>
              <div class='footer'>
                <abbr class="published date" title="2009-02-20T12:27:50-05:00">Feb 20, 2009 at 12:27</abbr>
                &nbsp; | &nbsp; tagged:
                <a href="/tags.html#osx">osx</a>
              </div>
            </div>
            <div class='article hentry'>
              <!-- %h3.entry-title{:rel => 'bookmark'}= link_to_page(page) -->
              <h3 class='entry-title'><a href="/2009/01/17/going-functional">Going Functional</a></h3>
              <div class='entry-content'>
                <p>So, some <a href="http://news.ycombinator.com/">Hacker News</a> users recently <a href="http://news.ycombinator.com/item?id=428248">decided</a> that it'd be a good idea to <a href="http://groups.google.com/group/hacker-news-reads-sicp/">work through</a> the <a href="http://mitpress.mit.edu/sicp/">SICP</a> together and make a kind of book club out of the deal over irc.</p>
                
                <p>When I heard of it, I thought it'd be a good excuse to work through the text myself (since it was just sitting on my bookshelf), and also stretch my brain a bit more teaching myself <a href="http://clojure.org/">Clojure</a>.  I'm almost done the reading and <a href="http://github.com/jamie/sicp/">exercises</a> for section 1.1, and I'm already finding it a valuable exercise.</p>
                
                <p>The third exercise asks us to "define a procedure that takes three numbers as arguments and returns the sum of the squares of the two larger numbers."  At either extremity are two solutions.  The straightforward solution a new programmer can generate based solely on the first 20 pages of the text looks something like this:</p>
                
                <pre><code>(defn sum-largest-squares [a b c]&#x000A;  (cond (and (&lt; a b) (&lt; a c)) (+ (* b b) (* c c))&#x000A;        (and (&lt; b a) (&lt; b c)) (+ (* a a) (* c c))&#x000A;        (and (&lt; c a) (&lt; c b)) (+ (* a a) (* b b))))&#x000A;</code></pre>
                
                <p>Some tests to prove correctness, returning 2^2 + 3^2, or 13, are:</p>
                
                <pre><code>(sum-largest-squares 1 2 3)&#x000A;(sum-largest-squares 2 3 1)&#x000A;(sum-largest-squares 3 1 2)&#x000A;</code></pre>
                
                <p>An interesting (and enlightening) exercise is to take our naive function, and just start randomly refactoring, and see where it takes us.  One step at a time, making sure we are always passing our handful of test cases.  The goal is to decompose and abstract the function into more manageable pieces, with less repetition.  To start:</p>
                
                <pre><code>(defn sum-largest-squares [a b c]&#x000A;  (cond (and (&lt; a b) (&lt; a c)) (+ (square b) (square c))&#x000A;        (and (&lt; b a) (&lt; b c)) (+ (square a) (square c))&#x000A;        (and (&lt; c a) (&lt; c b)) (+ (square a) (square b))))&#x000A;</code></pre>
                
                <p>The square function is trivially pulling out (* x x), and conveniently is already present in Clojure.</p>
                
                <p>Second step is to pull out the three conditional clauses into sum-of-squares:</p>
                
                <pre><code>(defn sum-of-squares [a b]&#x000A;  (+ (square a) (square b)))&#x000A;&#x000A;(defn sum-largest-squares [a b c]&#x000A;  (cond (and (&lt; a b) (&lt; a c)) (sum-of-squares b c)&#x000A;        (and (&lt; b a) (&lt; b c)) (sum-of-squares a c)&#x000A;        (and (&lt; c a) (&lt; c b)) (sum-of-squares a b)))&#x000A;</code></pre>
                
                <p>Next, we can probably abstract the conditionals themselves, since what we're looking for is the smallest of three elements (min is also provided by clojure):</p>
                
                <pre><code>(defn sum-largest-squares [a b c]&#x000A;  (cond (= a (min a b c)) (sum-of-squares b c)&#x000A;        (= b (min a b c)) (sum-of-squares a c)&#x000A;        (= c (min a b c)) (sum-of-squares a b)))&#x000A;</code></pre>
                
                <p>Now, we've got a much more parallel structure here, so we should be able to collapse the conditional, and process the values first.</p>
                
                <p>I'll stop here, but there are a few different ways to get started with the next step - most involve transitioning our three arguments into a list at some point.  I've found it instructive to play around with the different ways of decomposing the problem (including a few side steps along the way to the route I've followed above).  I'm thinking that as I continue with the SICP exercies, I'll try and make a habit of not stopping with the first solution that springs out of my text editor, but to try and explore the structure of the code through refactoring.</p>
                
                <p>Also, while I never managed to figure out refactoring steps that would produce it, I think the most straightforward functional solution (rather than the semi-iterative solution we started with above) winds up being this - it has a certain elegance to it, no?</p>
                
                <pre><code>(defn sum-largest-squares [a b c]&#x000A;  (apply + (map square (rest (sort (list a b c))))))&#x000A;</code></pre>
              </div>
              <div class='footer'>
                <abbr class="published date" title="2009-01-17T10:00:00-05:00">Jan 17, 2009 at 10:00</abbr>
                &nbsp; | &nbsp; tagged:
                <a href="/tags.html#clojure">clojure</a>
                <a href="/tags.html#sicp">sicp</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class='span-20 last' id='footer'>
        <p>
          &copy; 2006-2008 <span class="author vcard"><span class="fn">Jamie Macey</span></span>
          |
          Original design: <a href="http://www.styleshout.com/templates/preview/CoolWater1-0/index.html">CoolWater</a> by <a href="http://www.styleshout.com/">styleshout</a>
        </p>
      </div>
    </div>
  </body>
</html>
